(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{6564:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/output",function(){return s(7277)}])},4430:function(e,t,s){"use strict";s.d(t,{Z:function(){return KPI}});var a=s(5893);function KPI(e){let{name:t,value:s,className:i}=e;return(0,a.jsxs)("div",{className:"w-60 space-y-2 border border-slate-600 bg-slate-800 p-4 ".concat(i),children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:t}),(0,a.jsx)("p",{className:"text-3xl font-semibold",children:s})]})}},2726:function(e,t,s){"use strict";s.d(t,{Z:function(){return SecondaryButton}});var a=s(5893);function SecondaryButton(e){let{children:t,className:s,...i}=e;return(0,a.jsx)("button",{className:"text-sm hover:underline ".concat(s),...i,children:t})}},8716:function(e,t,s){"use strict";s.d(t,{Z:function(){return TableData}});var a=s(5893);function TableData(e){let{children:t,className:s}=e;return(0,a.jsx)("td",{className:"py-4 px-4 ".concat(s),children:t})}},128:function(e,t,s){"use strict";s.d(t,{Z:function(){return TableHeader}});var a=s(5893);function TableHeader(e){let{children:t}=e;return(0,a.jsx)("th",{className:"py-4 px-4 text-left text-xs font-semibold uppercase tracking-wider text-slate-400",children:t})}},7606:function(e,t,s){"use strict";s.d(t,{Z:function(){return Tag}});var a=s(5893);function Tag(e){let{children:t,className:s,...i}=e;return(0,a.jsx)("p",{className:"inline-block bg-slate-800 py-1 px-2 text-xs font-medium uppercase tracking-wider ".concat(s),...i,children:t})}},7277:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return OutputPage}});var a=s(5893),i=s(2680),n=s(2281),l=s(8395),r=s(7294),c=s(1163);function LoadingSpinner(){return(0,a.jsx)("svg",{className:"h-10 w-10 animate-spin fill-white text-white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"})})}var d=s(9253),o=s(5458),u=s(4195),x=s(3023),h=s(5358),m=s(4321),f=s(4545);function AverageBarChart(e){let{data:t,average:s}=e;return(0,a.jsx)(d.h,{width:"100%",height:"100%",children:(0,a.jsxs)(o.v,{data:t,stackOffset:"none",layout:"horizontal",children:[(0,a.jsx)(u.q,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#475569"}),(0,a.jsx)(x.K,{dataKey:"name",interval:"preserveStartEnd",tick:{transform:"translate(0, 6)"},style:{fontSize:"12px",marginTop:"20px"},stroke:"#cbd5e1",tickLine:!1,axisLine:!1}),(0,a.jsx)(h.B,{width:48,axisLine:!1,tickLine:!1,domain:[0,"auto"],type:"number",tick:{transform:"translate(-3, 0)"},style:{fontSize:"12px"},stroke:"#cbd5e1",tickFormatter:e=>Intl.NumberFormat("us").format(e).toString()}),["Weight"].map(e=>(0,a.jsx)(m.$,{maxBarSize:56,name:e,type:"linear",dataKey:e,fill:"#cbd5e1",isAnimationActive:!0},e)),(0,a.jsx)(f.d,{y:s,stroke:"#d946ef",strokeWidth:2})]})})}var j=s(4430);function OutputStats(e){let{projectData:t,solution:s}=e,getChartData=()=>t.output_history.find(e=>e.output_id===t.current_selected_output_id).state.users.map(e=>({name:e.name,Weight:t.tasks.filter(t=>s.assignment[t.id+1]===e.id+1).reduce((e,t)=>e+t.weight,0)})),getAverageWorkload=()=>{let e=getChartData();return e.reduce((e,t)=>e+t.Weight,0)/e.length};return(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex w-60 flex-col space-y-4",children:[(0,a.jsx)(j.Z,{name:"Avg. User Workload",value:getAverageWorkload().toFixed(1)}),(0,a.jsx)(j.Z,{name:"Coefficient of Variation",value:(()=>{let e=getAverageWorkload(),t=getChartData(),s=t.reduce((t,s)=>t+Math.pow(s.Weight-e,2),0)/t.length;return Math.sqrt(s)/e*100})().toFixed(1)+"%"}),(0,a.jsx)(j.Z,{name:"Total Workload",value:getChartData().reduce((e,t)=>e+t.Weight,0)})]}),(0,a.jsx)("div",{className:"flex-1 border border-slate-600 bg-slate-800 p-4 pl-5",children:(0,a.jsx)(AverageBarChart,{data:getChartData(),average:getAverageWorkload()})})]})}var k=s(128),p=s(8716),g=s(2726),N=s(7606);function OutputTableViews(e){let{solution:t,oldSolutionState:s}=e,[n,l,c]=(0,i.Z)(),[d,o]=(0,r.useState)(!0);if(c)return null;let u=n.locked_tasks?n.locked_tasks:[],setLockedTasks=e=>{l({type:"SET_LOCKED_TASKS",tasks:e([...u])})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-8 text-slate-300",children:'The following table displays the allocations of tasks and users. This allocation calculation can be re-run with certain tasks or users "locked" (in which their allocations remain).'}),(0,a.jsx)("div",{className:"mt-8 flex justify-end",children:(0,a.jsx)(ViewToggle,{isTaskView:d,setTaskView:o})}),(0,a.jsx)("div",{className:"mt-4",children:d?(0,a.jsx)(TasksTable,{tasks:n.tasks,users:n.users,solution:t,oldSolutionState:s,lockedTasks:u,setLockedTasks:setLockedTasks}):(0,a.jsx)(UsersTable,{users:n.users,tasks:n.tasks,solution:t,oldSolutionState:s,lockedTasks:u,setLockedTasks:setLockedTasks})})]})}function UsersTable(e){let{users:t,tasks:s,solution:i,oldSolutionState:n,lockedTasks:l,setLockedTasks:r}=e;return(0,a.jsxs)("table",{className:"w-full divide-y-2 divide-slate-600 border border-slate-600",children:[(0,a.jsx)("thead",{className:"bg-slate-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(k.Z,{children:"User"}),(0,a.jsx)(k.Z,{children:"Task"}),(0,a.jsx)(k.Z,{})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-600",children:[...new Set(Object.values(i.assignment))].map(e=>{let c=parseInt(e)-1,d=t.find(e=>e.id===c),o=n.users.find(e=>e.id===c);return d?(0,a.jsx)(UserHeader,{user:d,tasks:s,solution:i,oldSolutionState:n,deleted:!1,edited:JSON.stringify(d)!==JSON.stringify(o),setLocked:r,lockedTasks:l},d.id):(0,a.jsx)(UserHeader,{user:o,tasks:s,solution:i,oldSolutionState:n,deleted:!0,edited:!1,setLocked:r,lockedTasks:l},"old".concat(o.id))})})]})}function UserHeader(e){let{user:t,tasks:s,solution:i,oldSolutionState:n,deleted:l,edited:c,setLocked:d,lockedTasks:o}=e;return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)("tr",{className:"border-b-2 border-slate-600",children:(0,a.jsx)("th",{colSpan:3,className:"bg-slate-700 p-4 text-left font-normal text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:l?"opacity-25":"",children:t.name}),l?(0,a.jsx)(N.Z,{className:"text-slate-400",children:"Removed"}):null,!l&&c?(0,a.jsx)(N.Z,{className:"text-slate-400",children:"Edited"}):null]}),l?null:(0,a.jsx)(LockAllButton,{onClick:()=>d(e=>{let s=[...e];return Object.keys(i.assignment).filter(e=>i.assignment[e]===t.id+1).forEach(t=>{e.includes(parseInt(t)-1)||s.push(parseInt(t)-1)}),s})})]})})}),Object.keys(i.assignment).filter(e=>i.assignment[e]===t.id+1).map(e=>{let t=parseInt(e)-1,i=s.find(e=>e.id===t),r=n.tasks.find(e=>e.id===t);return(0,a.jsx)(UserRow,{task:i||r,userDeleted:l,deleted:!i,isLocked:i&&o.includes(i.id),setLocked:d,edited:i&&JSON.stringify(i)!==JSON.stringify(r)},i?i.id:"old"+r.id)})]},t.id)}function UserRow(e){let{task:t,isLocked:s,setLocked:i,userDeleted:n,deleted:l,edited:r}=e;return(0,a.jsxs)("tr",{children:[(0,a.jsx)(p.Z,{}),(0,a.jsx)(TaskDisplay,{task:t,className:n?"opacity-25":null,taskDeleted:l,edited:r}),l?null:(0,a.jsx)(p.Z,{children:(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(LockTaskButton,{isLocked:s,setLocked:e=>handleSetLocked(i,e,t)})})})]})}function TasksTable(e){let{tasks:t,users:s,solution:i,oldSolutionState:n,lockedTasks:l,setLockedTasks:r}=e;return(0,a.jsxs)("table",{className:"w-full divide-y-2 divide-slate-600 border border-slate-600",children:[(0,a.jsx)("thead",{className:"bg-slate-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(k.Z,{children:"Task"}),(0,a.jsx)(k.Z,{children:"User"}),(0,a.jsx)(k.Z,{})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-600",children:Object.keys(i.assignment).map(e=>{let c=parseInt(e)-1,d=t.find(e=>e.id===c),o=s.find(t=>t.id===i.assignment[e]-1),u=n.tasks.find(e=>e.id===c),x=n.users.find(t=>t.id===i.assignment[e]-1);return d&&o?(0,a.jsx)(TaskRow,{task:d,user:o,edited:JSON.stringify(d)!==JSON.stringify(u),isLocked:l.includes(c),setLocked:e=>handleSetLocked(r,e,d)},c):(0,a.jsx)(TaskRow,{task:u,taskDeleted:!0,user:x,isLocked:l.includes(c),setLocked:e=>handleSetLocked(r,e,d)},"old".concat(c))})})]})}function TaskDisplay(e){let{task:t,taskDeleted:s,edited:i,className:n}=e;return(0,a.jsx)(p.Z,{className:n,children:(0,a.jsxs)("div",{className:"flex flex-col items-start space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"".concat(s?"opacity-25":null),children:t.name}),i&&!s?(0,a.jsx)(N.Z,{className:"text-slate-400",children:"Edited"}):null,s?(0,a.jsx)(N.Z,{className:"text-slate-400",children:"Removed"}):null]}),(0,a.jsx)("p",{className:"text-sm text-slate-400 ".concat(s?"opacity-25":null),children:t.description})]})})}function TaskRow(e){let{task:t,isLocked:s,setLocked:i,user:n,taskDeleted:l,edited:r}=e;return(0,a.jsxs)("tr",{children:[(0,a.jsx)(TaskDisplay,{task:t,taskDeleted:l,edited:r}),(0,a.jsx)(p.Z,{className:"".concat(l?"opacity-25":null),children:n.name}),l?null:(0,a.jsx)(p.Z,{children:(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(LockTaskButton,{isLocked:s,setLocked:i})})})]})}function LockTaskButton(e){let{isLocked:t,setLocked:s}=e;return(0,a.jsx)(g.Z,{onClick:()=>s(!t),children:t?"Unlock":"Lock"})}function LockAllButton(e){let{onClick:t}=e;return(0,a.jsx)(g.Z,{onClick:t,children:"Lock All"})}function handleSetLocked(e,t,s){e(t?e=>[...e,s.id]:e=>e.filter(e=>e!==s.id))}function ViewToggle(e){let{isTaskView:t,setTaskView:s}=e,i="bg-slate-700 text-white",n="text-slate-400 hover:text-slate-200";return(0,a.jsxs)("div",{className:"flex items-center border border-slate-600 bg-slate-800 text-sm",children:[(0,a.jsx)("button",{className:"px-2 py-1 ".concat(t?i:n),onClick:()=>s(!0),children:"Task View"}),(0,a.jsx)("button",{className:"px-2 py-1 ".concat(t?n:i),onClick:()=>s(!1),children:"User View"})]})}var y=s(3568),v=s(6154),b=s(659);function OutputPage(){let e=(0,c.useRouter)(),[t,s,d]=(0,i.Z)(),[o,u]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{let wait=async()=>{let e=setInterval(async()=>{let a=await v.Z.post(b.Mt,{appName:"task-allocation",jobid:t.output_history.find(e=>e.output_id===t.current_selected_output_id).job_id},{headers:{"Content-Type":"application/json"}});a.data&&a.data.status&&"wait"!==a.data.status&&(clearInterval(e),u(!1),s({type:"ADD_OUTPUT",output:a.data}))},3e3)};!d&&t.current_selected_output_id&&t.output_history&&t.output_history.some(e=>e.output_id===t.current_selected_output_id&&"wait"===e.status)&&!o&&(u(!0),wait())},[d,t,s]),d)return null;let x=t.output_history?t.output_history.find(e=>e.output_id===t.current_selected_output_id):null;if(!x||!x.status)return(0,a.jsx)(PageLayout,{children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(n.Z,{className:"h-12 w-12 text-slate-500"}),(0,a.jsx)("p",{className:"text-medium mt-2",children:"No output allocation"}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Get started by generating the first output allocation from your input."}),(0,a.jsx)(l.Z,{className:"mt-6",onClick:a=>(0,y.E)(a,t,s,e),children:"Generate Solution"})]})})});if("wait"===x.status)return(0,a.jsx)(PageLayout,{children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(LoadingSpinner,{}),(0,a.jsx)("p",{className:"text-medium mt-2",children:"Generating solution..."})]})})});if("ok"!==x.status)return(0,a.jsx)(PageLayout,{children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(n.Z,{className:"h-12 w-12 text-slate-500"}),(0,a.jsx)("p",{className:"text-medium mt-2",children:"Failed output allocation"}),(0,a.jsxs)("p",{className:"text-sm text-slate-400",children:["It was not possible to find a solution to output version #",x.output_id," with the supplied inputs."]})]})})});let h=x.solution,m=x.state;return(0,a.jsxs)(PageLayout,{children:[(0,a.jsx)(OutputStats,{projectData:t,solution:h}),(0,a.jsx)(OutputTableViews,{solution:h,oldSolutionState:m})]})}function PageLayout(e){let{children:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Solution Allocation"}),(0,a.jsx)("p",{className:"text-slate-300",children:"See recommended task allocations below which may be edited."})]}),(0,a.jsx)("div",{className:"mt-8",children:t})]})}}},function(e){e.O(0,[215,774,888,179],function(){return e(e.s=6564)}),_N_E=e.O()}]);