(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{9558:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/output",function(){return s(1931)}])},6627:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(4848);function l(e){let{name:t,value:s,className:l}=e;return(0,i.jsxs)("div",{className:"w-60 space-y-2 border border-slate-600 bg-slate-800 p-4 ".concat(l),children:[(0,i.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wider text-slate-400",children:t}),(0,i.jsx)("p",{className:"text-3xl font-semibold",children:s})]})}},1939:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(4848);function l(e){let{children:t,className:s,...l}=e;return(0,i.jsx)("button",{className:"text-sm hover:underline ".concat(s),...l,children:t})}},7661:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(4848);function l(e){let{children:t,className:s}=e;return(0,i.jsx)("td",{className:"py-4 px-4 ".concat(s),children:t})}},5120:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(4848);function l(e){let{children:t}=e;return(0,i.jsx)("th",{className:"py-4 px-4 text-left text-xs font-semibold uppercase tracking-wider text-slate-400",children:t})}},345:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(4848);function l(e){let{children:t,className:s,...l}=e;return(0,i.jsx)("p",{className:"inline-block bg-slate-800 py-1 px-2 text-xs font-medium uppercase tracking-wider ".concat(s),...l,children:t})}},1931:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>J});var i=s(4848),l=s(639),a=s(7023),n=s(6475),r=s(6540),c=s(6715);function d(){return(0,i.jsx)("svg",{className:"h-10 w-10 animate-spin fill-white text-white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{d:"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z"})})}var o=s(949),u=s(4611),x=s(7323),m=s(1672),h=s(3087),j=s(2906),f=s(2462);function p(e){let{data:t,average:s}=e;return(0,i.jsx)(o.u,{width:"100%",height:"100%",children:(0,i.jsxs)(u.E,{data:t,stackOffset:"none",layout:"horizontal",children:[(0,i.jsx)(x.d,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#475569"}),(0,i.jsx)(m.W,{dataKey:"name",interval:"preserveStartEnd",tick:{transform:"translate(0, 6)"},style:{fontSize:"12px",marginTop:"20px"},stroke:"#cbd5e1",tickLine:!1,axisLine:!1}),(0,i.jsx)(h.h,{width:48,axisLine:!1,tickLine:!1,domain:[0,"auto"],type:"number",tick:{transform:"translate(-3, 0)"},style:{fontSize:"12px"},stroke:"#cbd5e1",tickFormatter:e=>Intl.NumberFormat("us").format(e).toString()}),["Weight"].map(e=>(0,i.jsx)(j.y,{maxBarSize:56,name:e,type:"linear",dataKey:e,fill:"#cbd5e1",isAnimationActive:!0},e)),(0,i.jsx)(f.e,{y:s,stroke:"#d946ef",strokeWidth:2})]})})}var k=s(6627);function N(e){let{projectData:t,solution:s}=e,l=()=>t.output_history.find(e=>e.output_id===t.current_selected_output_id).state.users.map(e=>({name:e.name,Weight:t.tasks.filter(t=>s.assignment[t.id+1]===e.id+1).reduce((e,t)=>e+t.weight,0)})),a=()=>{let e=l();return e.reduce((e,t)=>e+t.Weight,0)/e.length};return(0,i.jsxs)("div",{className:"flex space-x-4",children:[(0,i.jsxs)("div",{className:"flex w-60 flex-col space-y-4",children:[(0,i.jsx)(k.A,{name:"Avg. User Workload",value:a().toFixed(1)}),(0,i.jsx)(k.A,{name:"Coefficient of Variation",value:(()=>{let e=a(),t=l();return Math.sqrt(t.reduce((t,s)=>t+Math.pow(s.Weight-e,2),0)/t.length)/e*100})().toFixed(1)+"%"}),(0,i.jsx)(k.A,{name:"Total Workload",value:l().reduce((e,t)=>e+t.Weight,0)})]}),(0,i.jsx)("div",{className:"flex-1 border border-slate-600 bg-slate-800 p-4 pl-5",children:(0,i.jsx)(p,{data:l(),average:a()})})]})}var v=s(5120),y=s(7661),b=s(1939),g=s(345);function w(e){let{solution:t,oldSolutionState:s}=e,[a,n,c]=(0,l.A)(),[d,o]=(0,r.useState)(!0);if(c)return null;let u=a.locked_tasks?a.locked_tasks:[],x=e=>{n({type:"SET_LOCKED_TASKS",tasks:e([...u])})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"mt-8 text-slate-300",children:'The following table displays the allocations of tasks and users. This allocation calculation can be re-run with certain tasks or users "locked" (in which their allocations remain).'}),(0,i.jsx)("div",{className:"mt-8 flex justify-end",children:(0,i.jsx)(I,{isTaskView:d,setTaskView:o})}),(0,i.jsx)("div",{className:"mt-4",children:d?(0,i.jsx)(T,{tasks:a.tasks,users:a.users,solution:t,oldSolutionState:s,lockedTasks:u,setLockedTasks:x}):(0,i.jsx)(_,{users:a.users,tasks:a.tasks,solution:t,oldSolutionState:s,lockedTasks:u,setLockedTasks:x})})]})}function _(e){let{users:t,tasks:s,solution:l,oldSolutionState:a,lockedTasks:n,setLockedTasks:r}=e;return(0,i.jsxs)("table",{className:"w-full divide-y-2 divide-slate-600 border border-slate-600",children:[(0,i.jsx)("thead",{className:"bg-slate-800",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)(v.A,{children:"User"}),(0,i.jsx)(v.A,{children:"Task"}),(0,i.jsx)(v.A,{})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-slate-600",children:[...new Set(Object.values(l.assignment))].map(e=>{let c=parseInt(e)-1,d=t.find(e=>e.id===c),o=a.users.find(e=>e.id===c);return d?(0,i.jsx)(A,{user:d,tasks:s,solution:l,oldSolutionState:a,deleted:!1,edited:JSON.stringify(d)!==JSON.stringify(o),setLocked:r,lockedTasks:n},d.id):(0,i.jsx)(A,{user:o,tasks:s,solution:l,oldSolutionState:a,deleted:!0,edited:!1,setLocked:r,lockedTasks:n},"old".concat(o.id))})})]})}function A(e){let{user:t,tasks:s,solution:l,oldSolutionState:a,deleted:n,edited:c,setLocked:d,lockedTasks:o}=e;return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)("tr",{className:"border-b-2 border-slate-600",children:(0,i.jsx)("th",{colSpan:3,className:"bg-slate-700 p-4 text-left font-normal text-white",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:n?"opacity-25":"",children:t.name}),n?(0,i.jsx)(g.A,{className:"text-slate-400",children:"Removed"}):null,!n&&c?(0,i.jsx)(g.A,{className:"text-slate-400",children:"Edited"}):null]}),n?null:(0,i.jsx)(C,{onClick:()=>d(e=>{let s=[...e];return Object.keys(l.assignment).filter(e=>l.assignment[e]===t.id+1).forEach(t=>{e.includes(parseInt(t)-1)||s.push(parseInt(t)-1)}),s})})]})})}),Object.keys(l.assignment).filter(e=>l.assignment[e]===t.id+1).map(e=>{let t=parseInt(e)-1,l=s.find(e=>e.id===t),r=a.tasks.find(e=>e.id===t);return(0,i.jsx)(S,{task:l||r,userDeleted:n,deleted:!l,isLocked:l&&o.includes(l.id),setLocked:d,edited:l&&JSON.stringify(l)!==JSON.stringify(r)},l?l.id:"old"+r.id)})]},t.id)}function S(e){let{task:t,isLocked:s,setLocked:l,userDeleted:a,deleted:n,edited:r}=e;return(0,i.jsxs)("tr",{children:[(0,i.jsx)(y.A,{}),(0,i.jsx)(L,{task:t,className:a?"opacity-25":null,taskDeleted:n,edited:r}),n?null:(0,i.jsx)(y.A,{children:(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(E,{isLocked:s,setLocked:e=>D(l,e,t)})})})]})}function T(e){let{tasks:t,users:s,solution:l,oldSolutionState:a,lockedTasks:n,setLockedTasks:r}=e;return(0,i.jsxs)("table",{className:"w-full divide-y-2 divide-slate-600 border border-slate-600",children:[(0,i.jsx)("thead",{className:"bg-slate-800",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)(v.A,{children:"Task"}),(0,i.jsx)(v.A,{children:"User"}),(0,i.jsx)(v.A,{})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-slate-600",children:Object.keys(l.assignment).map(e=>{let c=parseInt(e)-1,d=t.find(e=>e.id===c),o=s.find(t=>t.id===l.assignment[e]-1),u=a.tasks.find(e=>e.id===c),x=a.users.find(t=>t.id===l.assignment[e]-1);return d&&o?(0,i.jsx)(O,{task:d,user:o,edited:JSON.stringify(d)!==JSON.stringify(u),isLocked:n.includes(c),setLocked:e=>D(r,e,d)},c):(0,i.jsx)(O,{task:u,taskDeleted:!0,user:x,isLocked:n.includes(c),setLocked:e=>D(r,e,d)},"old".concat(c))})})]})}function L(e){let{task:t,taskDeleted:s,edited:l,className:a}=e;return(0,i.jsx)(y.A,{className:a,children:(0,i.jsxs)("div",{className:"flex flex-col items-start space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("span",{className:"".concat(s?"opacity-25":null),children:t.name}),l&&!s?(0,i.jsx)(g.A,{className:"text-slate-400",children:"Edited"}):null,s?(0,i.jsx)(g.A,{className:"text-slate-400",children:"Removed"}):null]}),(0,i.jsx)("p",{className:"text-sm text-slate-400 ".concat(s?"opacity-25":null),children:t.description})]})})}function O(e){let{task:t,isLocked:s,setLocked:l,user:a,taskDeleted:n,edited:r}=e;return(0,i.jsxs)("tr",{children:[(0,i.jsx)(L,{task:t,taskDeleted:n,edited:r}),(0,i.jsx)(y.A,{className:"".concat(n?"opacity-25":null),children:a.name}),n?null:(0,i.jsx)(y.A,{children:(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)(E,{isLocked:s,setLocked:l})})})]})}function E(e){let{isLocked:t,setLocked:s}=e;return(0,i.jsx)(b.A,{onClick:()=>s(!t),children:t?"Unlock":"Lock"})}function C(e){let{onClick:t}=e;return(0,i.jsx)(b.A,{onClick:t,children:"Lock All"})}function D(e,t,s){e(t?e=>[...e,s.id]:e=>e.filter(e=>e!==s.id))}function I(e){let{isTaskView:t,setTaskView:s}=e,l="bg-slate-700 text-white",a="text-slate-400 hover:text-slate-200";return(0,i.jsxs)("div",{className:"flex items-center border border-slate-600 bg-slate-800 text-sm",children:[(0,i.jsx)("button",{className:"px-2 py-1 ".concat(t?l:a),onClick:()=>s(!0),children:"Task View"}),(0,i.jsx)("button",{className:"px-2 py-1 ".concat(t?a:l),onClick:()=>s(!1),children:"User View"})]})}var W=s(9184),F=s(4335),U=s(6698);function J(){let e=(0,c.useRouter)(),[t,s,o]=(0,l.A)();console.log(t);let[u,x]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{let e=async()=>{let e=setInterval(async()=>{let i=await F.A.post(U.v5,{appName:"task-allocation",jobid:t.output_history.find(e=>e.output_id===t.current_selected_output_id).job_id},{headers:{"Content-Type":"application/json"}});i.data&&i.data.status&&"wait"!==i.data.status&&(clearInterval(e),x(!1),s({type:"ADD_OUTPUT",output:i.data}))},3e3)};!o&&t.current_selected_output_id&&t.output_history&&t.output_history.some(e=>e.output_id===t.current_selected_output_id&&"wait"===e.status)&&!u&&(x(!0),e())},[o,t,s]),o)return null;let m=t.output_history?t.output_history.find(e=>e.output_id===t.current_selected_output_id):null;if(!m||!m.status)return(0,i.jsx)(z,{children:(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)(a.A,{className:"h-12 w-12 text-slate-500"}),(0,i.jsx)("p",{className:"text-medium mt-2",children:"No output allocation"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"Get started by generating the first output allocation from your input."}),(0,i.jsx)(n.A,{className:"mt-6",onClick:i=>(0,W.E)(i,t,s,e),children:"Generate Solution"})]})})});if("wait"===m.status)return(0,i.jsx)(z,{children:(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)(d,{}),(0,i.jsx)("p",{className:"text-medium mt-2",children:"Generating solution..."})]})})});if("ok"!==m.status||!m.solution)return(0,i.jsx)(z,{children:(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)(a.A,{className:"h-12 w-12 text-slate-500"}),(0,i.jsx)("p",{className:"text-medium mt-2",children:"Failed output allocation"}),(0,i.jsxs)("p",{className:"text-sm text-slate-400",children:["It was not possible to find a solution to output version #",m.output_id," with the supplied inputs."]})]})})});let h=m.solution,j=m.state;return(0,i.jsxs)(z,{children:[(0,i.jsx)(N,{projectData:t,solution:h}),(0,i.jsx)(w,{solution:h,oldSolutionState:j})]})}function z(e){let{children:t}=e;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold",children:"Solution Allocation"}),(0,i.jsx)("p",{className:"text-slate-300",children:"See recommended task allocations below which may be edited."})]}),(0,i.jsx)("div",{className:"mt-8",children:t})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[711,636,593,792],()=>t(9558)),_N_E=e.O()}]);